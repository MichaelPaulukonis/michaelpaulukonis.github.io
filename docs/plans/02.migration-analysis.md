# Nuxt 4 + Content v3 Migration Analysis

## Overview

The goal is to migrate the existing Nuxt application to a new project structure running Nuxt 4 and Content v3 (referred to as Content 3.8/3.0). The current codebase uses a mix of Nuxt 3 and Content v3 syntax that may be incomplete or using compatibility modes (e.g., `queryContent` vs `queryCollection`).

## 1. Dependencies to Install

The target project needs these dependencies to support existing code (unless refactored):

- `sass` (for SCSS support if used, though only CSS seen so far)
- `pug` & `@vue/language-plugin-pug` (Required for `index.vue` and `components/blog/pinned.vue`)
- `@nuxtjs/tailwindcss` (Standard styling)
- `@nuxt/fonts` (Used in config)
- `better-sqlite3` (Required for Content v3 local database)

## 2. Assets & Content Migration

The following directories should be copied to the new project:

- **`content/`**: Contains the source of truth for the blog.
- **`public/`**: Contains static assets (images, favicons).
- **`assets/`**: Contains global CSS.
- **`layouts/`**: `default.vue` and `purple.vue`.
- **`components/`**: All subdirectories.

## 3. Code Refactoring & Configuration

### A. Configuration (`nuxt.config.ts`)

- **Tailwind**: Port the massive `theme.extend` configuration from `tailwind.config.js` to the new project's `tailwind.config.js` or `nuxt.config.ts`.
- **Content**: Ensure `content.config.ts` exists and defines the `blog` collection properly.

### B. Pages & Data Fetching (Crucial)

Content v3 introduces breaking changes to data fetching.

#### `pages/index.vue`

- **Current**: Uses Pug and `<ContentQuery>`.
- **Change**:
  - Ensure Pug support is enabled.
  - Refactor `<ContentQuery>` to `useAsyncData` + `queryCollection('blog')`.
  - Filter for `pinned` tag using `.where('tags', 'LIKE', '%pinned%')` (SQL-like syntax) instead of Mongo-like syntax.

#### `pages/blog/[...slug].vue`

- **Current**: Uses `queryContent`, `findSurround`, and `<ContentDoc>`.
- **Change**:
  - Replace `queryContent('/blog')` with `queryCollection('blog')`.
  - `findOne()` becomes `.first()`.
  - `findSurround` needs to be reimplemented or checked if `surround()` helper exists in the specific Content v3 version. If not, separate queries for next/prev are needed.
  - Replace `<ContentDoc>` with manual fetching + `<ContentRenderer :value="article" />`.
  - Update `useHead` logic to ensure accessing properties on the new data object works (check if structure is flat or nested).

### C. Components

- **`components/blog/pinned.vue`**: Uses Pug. Needs Pug support.
- **`components/content/`**: Ensure these overwrite the default markdown components correctly in v3.

## 4. Execution Plan

1. **Setup**: Install Pug and Sass in the new project.
2. **Copy**: Transfer `content/`, `public/`, `assets/`, `components/`, `layouts/`.
3. **Config**: Apply Tailwind config.
4. **Refactor**:
    - Convert `index.vue` data fetching.
    - Convert `blog/[...slug].vue` data fetching.
5. **Verify**: Check homepage pinned posts and individual blog post rendering.

## 5. Potential Pitfalls

- **SQL Syntax**: Content v3 uses SQL-like filtering. `tags` array filtering might differ (e.g. needing JSON functions or strict string matching).
- **Date Formatting**: Ensure `$formatDate` plugin is migrated or available.
- **Pug**: If Pug setup is tricky with Nuxt 4, consider converting those 2 files to HTML.
